<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Scarecrow Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: #eee; text-align: center; }
        .grid { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .card { background: #222; padding: 20px; border-radius: 10px; border-top: 5px solid #007bff; min-width: 150px; }
        .danger { border-top-color: #ff4d4d; background: #331111; }
        .chart-box { width: 80%; margin: 30px auto; background: #222; padding: 15px; border-radius: 10px; }
        #status-txt { font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>
    <h1>üõ∞Ô∏è Scarecrow Real-Time System</h1>
    <p>Server Status: <span id="status-txt">Connecting...</span></p>

    <div class="grid">
        <div class="card" id="card-dist">
            <h3>Jarak</h3>
            <p><span id="val-dist">0</span> cm</p>
        </div>
        <div class="card" id="card-pir">
            <h3>Gerakan</h3>
            <p id="val-pir">Aman</p>
        </div>
        <div class="card">
            <h3>Servo</h3>
            <p><span id="val-angle">0</span>¬∞</p>
        </div>
    </div>

    <div class="chart-box">
        <canvas id="myChart"></canvas>
    </div>

    <script>
        const beep = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
        
        const ctx = document.getElementById('myChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(20).fill(''),
                datasets: [{ label: 'Jarak (cm)', data: Array(20).fill(0), borderColor: '#007bff', tension: 0.3 }]
            },
            options: { animation: false, scales: { y: { min: 0, max: 200 } } }
        });

        function update() {
            fetch('/data').then(r => r.json()).then(data => {
                document.getElementById('val-dist').innerText = data.distance;
                document.getElementById('val-angle').innerText = data.angle;
                
                const pirTxt = document.getElementById('val-pir');
                pirTxt.innerText = data.motion ? "‚ö†Ô∏è ADA OBJEK!" : "Aman";
                
                document.getElementById('status-txt').innerText = "ONLINE";
                document.getElementById('status-txt').style.color = "#4dff88";

                // Logika Bahaya & Beep
                if (data.status === "ON") {
                    document.getElementById('card-dist').classList.add('danger');
                    document.getElementById('card-pir').classList.add('danger');
                    beep.play().catch(e => {}); // Mainkan suara (perlu interaksi user pertama kali)
                } else {
                    document.getElementById('card-dist').classList.remove('danger');
                    document.getElementById('card-pir').classList.remove('danger');
                }

                chart.data.datasets[0].data.push(data.distance);
                chart.data.datasets[0].data.shift();
                chart.update();
            }).catch(e => {
                document.getElementById('status-txt').innerText = "OFFLINE";
                document.getElementById('status-txt').style.color = "red";
            });
        }
        setInterval(update, 800);
    </script>
</body>
</html>
